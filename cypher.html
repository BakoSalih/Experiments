<!doctype html>
<html>
<head>
  <meta charset="utf-8">
  <title>Hello World</title>

  <script src="https://cdnjs.cloudflare.com/ajax/libs/pixi.js/5.1.3/pixi.min.js"></script>

  <style>
	body {background-color: white;}
	.row {
  display: flex;
}

.column {
  flex: 50%;
  background-color: lightgray;
}

.input0 {
	padding: 10px
}
   </style>
</head>
<body>

<div class="row">
  <div class="column", id="simulation">
	<div id="sim"></div>
  </div>
  <div class="column">
	<div id="in1", class="input0">n = </div>
	<div id="in2", class="input0">m = </div>
  </div>
</div>

<button onclick="myFunction()">Add</button>
<button onclick="myRemove()">Remove</button>

<script type="text/javascript">

let type = "WebGL"
if(!PIXI.utils.isWebGLSupported()){
  type = "canvas"
}
//Create a Pixi Application
let app = new PIXI.Application({
  width: 250,
  height: 250,
  antialias: false,
  transparent: true,
  resolution: 2
}
);

//Add the canvas that Pixi automatically created for you to the HTML document
//document.body.appendChild(app.view);
document.getElementById("sim").appendChild(app.view);


//load an image and run the `setup` function when it's done
const loader = new PIXI.Loader();
loader
.load(setup);


//This `setup` function will run when the image has loaded
function setup() {
	let container = new PIXI.Container();
	app.stage.addChild(container);

	let alphabet = "abcdefghijklmnopqrstuvwxyz";
	const n = alphabet.length

	radius = 100;
	wheel = [];
	for (i = 0; i < n; i++) {
		let text = new PIXI.Text(alphabet[i],{fontFamily : 'Arial', fontSize: 10, fill : 0x000000, align : 'center'});
		text.anchor.set(0.5);
    text.angle = 90*(1+4*i/n);
		text.x = radius*Math.cos(i/n * 2* Math.PI);
		text.y = radius*Math.sin(i/n * 2*Math.PI);

		wheel.push(text);

		container.addChild(text);
	}

	container.interactive = true;

	container.buttonMode = true;

	container.on('mousedown', onDown)
        .on('mousemove', onDragMove);
	container.on('mouseup', onRelease).on('mouseupoutside',onRelease);

	container.x = app.screen.width / 2;
	container.y = app.screen.height / 2;


	app.ticker.add((delta) => {
			//container.rotation += 0.01* delta;

	});


}

function onDown(e)
{
    for (i = 0; i<wheel.length; i++) {
		//wheel[i].x = radius*Math.cos(i/n * 2* Math.PI);
		wheel[i].style.fill = 0xff1010;
		this.firstpos = [e.data.global.x -this.x, e.data.global.y -this.y];
    this.firstangle = anglerot(e.data.global.y -this.y, e.data.global.x -this.x);
	}
  document.getElementById("first").setAttribute("value", this.firstangle);
  document.getElementById("second").setAttribute("value", this.rotation);
    this.dragging = true;
}

function onDragMove(e)
{

	if (this.dragging)
    {

		const length = e.data.global.x - this.x;//e.data.global.x - this.x
		const height = e.data.global.y - this.y;//e.data.global.y - this.y

    const angle = anglerot(height,length);

		//document.getElementById("first").setAttribute("value", angle);

		this.rotation = angle;
    }

}

function anglerot(y,x) {
  if (x > 0)
  {
     return Math.atan(y/x);
  } else {
     return 1*Math.PI+Math.atan(y/x);
  }
}

function onRelease()
{
    for (i = 0; i<wheel.length; i++) {
		//wheel[i].x = radius*Math.cos(i/n * 2* Math.PI);
		wheel[i].style.fill = 0x000000;
	}
    this.dragging = false;
}

function myFunction() {
  setup();
}




function myRemove() {
  cl = app.stage.children;
  app.stage.removeChildren(0)
};

var y = document.createElement("INPUT");
  y.setAttribute("type", "text");
  y.setAttribute("value", 2);
  y.setAttribute("id", "first");
  document.body.appendChild(y);
  document.getElementById("in1").appendChild(y);

var x = document.createElement("INPUT");
  x.setAttribute("type", "text");
  x.setAttribute("value", 8);
  x.setAttribute("id", "second");
  //document.body.appendChild(x);
  document.getElementById("in2").appendChild(x);

</script>


</body>
</html>
