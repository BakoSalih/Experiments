<!doctype html>
<html>
<head>
  <meta charset="utf-8">
  <title>Hello World</title>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/pixi.js/5.1.3/pixi.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/gpu.js@latest/dist/gpu-browser.min.js"></script>
</head>
<body>

  <script type="text/javascript">
    let type = "WebGL"
    if(!PIXI.utils.isWebGLSupported()){
      type = "canvas"
    }

    //Create a Pixi Application
  let app = new PIXI.Application({
      width: 2000,
      height: 2000,
      antialias: true,
      transparent: true,
      resolution: 1
    }
  );

  //Add the canvas that Pixi automatically created for you to the HTML document
  document.body.appendChild(app.view);

  //load an image and run the `setup` function when it's done
  const loader = new PIXI.Loader();
  loader
  .add("images/tri.png")
  .add("images/tri2.png")
  .add("images/hex2.png")
    .load(setup);
  //This `setup` function will run when the image has loaded
  function setup() {
	
	let container = new PIXI.Container();
	
    app.stage.addChild(container);
	
	 particles = [];
    for (i = 0; i < 50; i++) {
		for (j = 0; j < 50; j++) {
			let sprite = new PIXI.Sprite(loader.resources["images/hex2.png"].texture);
			//let sprite2 = new PIXI.Sprite(loader.resources["images/tri.png"].texture);
			sprite.x = j*39 - 40 - 20*(i % 2);
			sprite.y = i*32;
			
			//sprite2.x = (j-1)*40 + 20 - 20*(i % 2);
			//sprite2.y = i*32;
			  
			particles.push(sprite);
			container.addChild(sprite);
			
//			particles.push(sprite2);
	//		container.addChild(sprite2);
			/*
				let sprite = new PIXI.Graphics();
			sprite.beginFill(0xFFFFFF);
			 sprite.drawRect(20*i % 1000,20*Math.floor(2*i/100), 10, 10);
			sprite.lineStyle(1, 0xFF3300, 1);
			sprite.endFill();
			*/
		}
	}

/*	
	let box = new PIXI.Container();
    app.stage.addChild(box);
    for (i = 0; i < 50; i++) {
		for (j = 0; j < 50; j++) {
	
			let sprite3 = new PIXI.Sprite(loader.resources["images/hex2.png"].texture);
			sprite3.x = j*40 - 40 - 20*(i % 2);
			sprite3.y = i*33;
			
			box.addChild(sprite3);
		}
	}
*/
	for (i = 0; i < particles.length; i++) {
		const sprite = particles[i];
		//sprite.tint = Math.random() * 0xFFFFFF;
		sprite.alpha= 0.2;
		sprite.interactive = true;
		sprite.hitArea = new PIXI.Polygon(0,33,19,44,38,32,38,10,19,0,0,10);
		sprite.interactionFrequency = 1;
	    sprite.mousedown = function(mouseData) {
		// if (this.alpha == 1) {
		//this.alpha = 0.1;
		//} else { 
		this.alpha = 1;
		//sprite.tint = Math.random()/100 * 0xFFFFFF;
		//}
		}
		sprite.tap  = function(mouseData) {
		// if (this.alpha == 1) {
		//this.alpha = 0.1;
		//} else { 
		this.alpha = 1;
		//sprite.tint = Math.random()/100 * 0xFFFFFF;
		//}
		}
		/*
		sprite.mouseout = function(mouseData) {
		if (this.alpha != 1) {
		this.alpha = 0.1;
		} else { 
		
		}
		
		}*/
		
	}
	
	// GPU calculation
	/*
	const gpu = new GPU();
    const multiplyMatrix = gpu.createKernel(function(a, b) {
        let sum = 0;
        for (let i = 0; i < 512; i++) {
            sum += a[this.thread.y][i] * b[i][this.thread.x];
        }
        return sum;
    }).setOutput([512, 512]);
	
	const a = new Array(); 
	for (let i = 0; i < 512; i++) {
		a[i] = new Array();
		for (let j = 0; j < 512; j++) {
			a[i][j] = 1;
		}
	}
    
	const c = multiplyMatrix(a, a);
	*/
	const gpu = new GPU();
	const add = gpu.createKernel(function(a, b) {
	return a[this.thread.x] + b[this.thread.x];
	}).setOutput([20]);
	
	const d = [];
	for (let i = 0; i < 20; i++) {
		d[i] = i;
	}
	
	const a = d.map(x => x**2);
	const b = d.map(x => x**3);
	
	const c = add(a,b);
	const basicText = new PIXI.Text();
	
	
	basicText.counter = 0;
	// basicText.text = 'Counter: ' + basicText.counter;
	basicText.text = 'Counter: ' + c;
	basicText.x = 50;
	basicText.y = 100;
	app.stage.addChild(basicText);
	
    //Start the game loop by adding the `gameLoop` function to
    //Pixi's `ticker` and providing it with a `delta` argument.
	counter = 0;
	var ticker = PIXI.Ticker.shared
	ticker.maxFPS = 0;
    ticker.add(() => {
	counter += 1;
	gameLoop();
	
	if (counter % 20 == 0) {
	// basicText.counter = Math.round(ticker.FPS);
	
	} else {}
	// basicText.text = 'Counter: ' + basicText.counter;
	// basicText.text = a[1][2];
	});
	
  }

  function gameLoop() {
  }
  </script>
</body>
</html>
